<link href="../../../Content/Editor.css" rel="stylesheet" />
<br><br><br><br>
<div class="container-fluid">
    <div>Choose what/where to edit/add </div>

    <div ng-init="GetSubTopics(0);addTopic = true">
        <span>Home</span>
        <select ng-repeat="subTopics in topics" ng-if="subTopics.length > 0" ng-model="selectedTopic" ng-options="t.TopicName for t in subTopics" ng-change="GetSubTopics(selectedTopic.TopicID, selectedTopic, $index)">
        <option value="">Nothing Selected</option>
    </select>
        <button data-toggle="modal" ng-click="showEditor= true" data-target="#new-topic-form" class="btn btn-sm btn-primary"><i class="fa fa-plus" aria-hidden="true" ></i>Add Topic</button> &nbsp &nbsp<button ng-click="StartEditing()" class="btn btn-md btn-danger"> Start Editing</button>
    </div>

    <br/>
    <button ng-click="SaveChanges()" ng-show="showEditor" id="save-btn">save</button>
    <div id="editor-div">
        <div class="col-sm-1">
            <ul>
                <li ng-click="AddLink()">Add Link </li>
                <li ng-click="AddVideoLink()">Add Video Link</li>
            </ul>
            <hr/>
            <ul>
                <li><i class="fa fa-picture-o" aria-hidden="true"></i></li>
                <li ng-click="MakeBold()"><b>Bold</b></li>
                <li ng-click="MakeItalic()"><em>Italic</em></li>
                <li ng-click="AddCode()"><code>{Code}</code></li>
                <li ng-click="MakeBlock()"><i class="fa fa-quote-left" aria-hidden="true"></i>
                    <i class="fa fa-quote-right" aria-hidden="true"></i>
                </li>
            </ul>
            <ul ui-sortable="sortableOptions" ng-model="list" class="list">
                <li ng-repeat="item in list" class="item">
                {{item.text}}
                </li>
            </ul>
        </div>
        <div class="col-sm-7">
           <li ng-repeat="entry in sortingLog" >
                {{entry}}
            </li>
            <div ng-show="showEditor" id="{{selectedTopicContent.TopicID}}">
                <!--Topic Heading-->
                <h3>
                    <input type="text" ng-model="selectedTopicContent.TopicName" />
                    <span class="input-label">*Topic Heading</span>
                </h3>

                <textarea ng-model="selectedTopicContent.About"></textarea>
                <span class="input-label">About the topic</span>

                <br/><br/>
                <!--Topic Body-->
                <div ui-sortable="sortableOptions" ng-model="selectedTopicContent.Links" class="topic-body">
                    <br/>
                    <div ng-repeat="link in selectedTopicContent.Links" id="{{link.LinkID}}" class="link-div">
                        
                        <h4>
                            <input type="text" ng-model="link.LinkHeading" />
                            <span class="input-label">*Link heading</span>
                        </h4>
                        <!--Image link-->
                        <div ng-if="link.LinkType == 'image'">


                            <br/>
                            <textarea rows="2" ng-model="link.LinkDetail"></textarea>
                            <span class="input-label">About the image</span>
                            <i class="fa fa-picture-o" aria-hidden="true" data-toggle="modal" data-target="#image-preview{{link.LinkID}}">Preview Image</i>
                            <input type="file"/>

                            <div id="image-preview{{link.LinkID}}" class="modal fade">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            <h4 class="modal-title">Image Preview</h4>
                                        </div>
                                        <div class="modal-body">
                                            <img ng-src="Resources/Images/{{link.Link1 | trustUrl}}" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!--Video Link-->
                        <div ng-if="link.LinkType == 'video'">

                            <input type="text" ng-model="link.Link1" />
                            <span class="input-label">*Embeded url</span>
                            <select ng-model="link.LinkType">
                            <option value="video">video url</option>
                            <option value="url">url to another page</option>
                        </select>

                            <textarea rows="2" ng-model="link.LinkDetail"></textarea>
                            <span class="input-label">About the video</span>
                        </div>

                        <!--Url-->
                        <div ng-if="link.LinkType == 'url'">

                            <input type="text" ng-model="link.Link1" />
                            <span class="input-label">url(optional)</span>
                            <select ng-model="link.LinkType">
                                <option value="video">video url</option>
                                <option value="url">url to another page</option>
                            </select>

                            <textarea ng-model="link.LinkDetail"></textarea>
                            <span class="input-label">About the Link</span>

                        </div>
                        <br/>
                        
                        <textarea ng-model="link.Description" ng-change="ShowPreview(link.Description)" ng-focus="FocusedTextarea($event);ShowPreview(link.Description)"></textarea>
                        <span class="input-label">Description</span>
                        <div ng-bind-html="link.Description"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-4">
            <div id="preview-div" ng-bind-html="currentPreview">
                
            </div>
        </div>
    </div>
</div>

<!--Modal for adding topic-->
<div id="new-topic-form" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Adding New Topic</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="control-label">Topic Name: </label>
                    <input class="form-control" type="text" ng-model="newTopic.TopicName" maxlength="30" />
                </div>
                <br/>
                <div class="form-group">
                    <label class="control-label">About: </label>
                    <textarea class="form-control" rows="10" cols="50" ng-model="newTopic.About"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger" ng-click="AddNewTopic()">Add</button>
            </div>
        </div>
    </div>
</div>
<script src="/Scripts/RangyInputs.js"></script>
<script src="/Scripts/sortable.js"></script>
<script src="/Scripts/Custom/Editor.js"></script>

